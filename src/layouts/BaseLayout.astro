---
import "@/styles/global.css";
import "@/styles/desktop.css";
import ViewToggle from "@/components/ViewToggle.astro";

interface Props {
  title: string;
  description?: string;
  image?: string;
  terminalMode?: boolean;
}

const {
  title,
  description = "A blog focused on coding, learning and managing by Gal Elmalah",
  image,
  terminalMode = false
} = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Navigation items
const navItems = [
  { label: "posts", href: "/posts" },
  { label: "series", href: "/series" },
  { label: "tags", href: "/tags" },
  { label: "archive", href: "/archives" },
  { label: "search", href: "/search" },
];
---

<!doctype html>
<html lang="en" class:list={[{ 'terminal-mode': terminalMode }]}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={canonicalURL} />
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content={terminalMode ? "dark" : "light dark"} />
    
    <!-- Primary Meta Tags -->
    <title>{title} | Gal.E</title>
    <meta name="title" content={`${title} | Gal.E`} />
    <meta name="description" content={description} />
    <meta name="author" content="Gal Elmalah" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {image && <meta property="og:image" content={new URL(image, Astro.site)} />}
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    {image && <meta property="twitter:image" content={new URL(image, Astro.site)} />}
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZYH05RT2G1"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-ZYH05RT2G1');
    </script>
    
    <!-- Theme Initialization -->
    <script is:inline>
      try {
        const theme = localStorage.getItem('terminal-theme');
        if (theme && theme !== 'default') {
          document.documentElement.setAttribute('data-theme', theme);
        }
      } catch (e) {
        // Ignore localStorage errors
      }
    </script>
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Gal.E Blog RSS" href="/rss.xml" />
  </head>
  
  <body class:list={[
    'min-h-screen flex flex-col',
    terminalMode ? 'terminal-page' : 'bg-white text-gray-900 font-sans'
  ]}>
    {terminalMode ? (
      <!-- Terminal Header -->
      <header class="fixed top-0 left-0 right-0 z-50 bg-term-bg-alt border-b border-term-fg-dark/20">
        <nav class="flex items-center justify-between px-4 py-2 font-mono text-sm">
          <a href="/" class="text-term-cyan hover:text-term-blue transition-colors">
            ~/gal.e
          </a>
          <ul class="flex items-center gap-4">
            {navItems.map(item => (
              <li>
                <a
                  href={item.href}
                  class="text-term-fg-dark hover:text-term-fg transition-colors"
                >
                  {item.label}
                </a>
              </li>
            ))}
            <li>
              <ViewToggle />
            </li>
          </ul>
        </nav>
      </header>
    ) : (
      <!-- Standard Header -->
      <header class="border-b border-gray-200">
        <nav class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
          <a href="/" class="text-xl font-semibold hover:text-accent transition-colors">
            Gal.E
          </a>
          <ul class="flex items-center gap-6 text-sm font-medium">
            {navItems.map(item => (
              <li>
                <a href={item.href} class="hover:text-accent transition-colors capitalize">
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </header>
    )}
    
    <main class:list={[
      'flex-1 w-full',
      terminalMode ? 'pt-12' : 'max-w-4xl mx-auto px-4 py-8'
    ]}>
      <slot />
    </main>
    
    {terminalMode ? (
      <!-- Terminal Footer -->
      <footer class="bg-term-bg border-t border-term-fg-dark/20 py-3 px-4 font-mono text-xs text-term-fg-dark">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
          <span>&copy; {new Date().getFullYear()} Gal Elmalah</span>
          <span class="text-term-comment"># exit 0</span>
        </div>
      </footer>
    ) : (
      <!-- Standard Footer -->
      <footer class="border-t border-gray-200 py-6">
        <div class="max-w-4xl mx-auto px-4 text-center text-sm text-gray-600">
          <p>&copy; {new Date().getFullYear()} Gal Elmalah. All rights reserved.</p>
          <div class="mt-2 flex justify-center gap-4">
            <a href="https://github.com/galelmalah" target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors">GitHub</a>
            <a href="https://twitter.com/galelmalah" target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors">Twitter</a>
            <a href="https://www.linkedin.com/in/gal-elmalah-71874115a/" target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors">LinkedIn</a>
            <a href="/rss.xml" class="hover:text-accent transition-colors">RSS</a>
          </div>
        </div>
      </footer>
    )}
<script>
  import { initTheme } from "@/scripts/terminal/home-init";
  
  // Initialize theme on load and after navigation
  initTheme();
  document.addEventListener('astro:page-load', initTheme);
</script>
  </body>
</html>
