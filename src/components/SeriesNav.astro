---
interface Post {
  slug: string;
  data: {
    title: string;
    date: Date;
  };
}

interface Props {
  seriesName: string;
  posts: Post[];
  currentSlug: string;
}

const { seriesName, posts, currentSlug } = Astro.props;

// Find current post index
const currentIndex = posts.findIndex((p) => currentSlug.includes(p.slug));
const totalPosts = posts.length;
---

<div class="my-6 p-4 bg-term-bg-alt/50 rounded-lg border border-term-fg-dark/30">
  <p class="text-sm text-term-fg-dark">
    This post is number <strong class="text-term-fg">{currentIndex + 1}</strong> of {totalPosts} posts
    in the series{" "}
    <a
      href={`/series/${seriesName.toLowerCase().replace(/\s+/g, "-")}`}
      class="text-term-cyan font-semibold hover:underline"
    >
      {seriesName}
    </a>.
  </p>

  <details class="mt-3">
    <summary
      class="text-sm font-medium cursor-pointer select-none text-term-fg"
    >
      View all posts in series
    </summary>
    <ol class="mt-2 space-y-1 list-decimal list-inside text-sm">
      {
        posts.map((post, index) => (
          <li
            class:list={[index === currentIndex ? "font-semibold text-term-cyan" : "text-term-fg-dark"]}
          >
            {index === currentIndex ? (
              <span>{post.data.title}</span>
            ) : (
              <a
                href={`/posts/${post.slug}`}
                class="text-term-fg-dark hover:text-term-cyan transition-colors"
              >
                {post.data.title}
              </a>
            )}
          </li>
        ))
      }
    </ol>
  </details>
</div>
